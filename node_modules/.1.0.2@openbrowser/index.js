

'use strict';

var execSync = require('child_process').execSync;
var opn = require('opn');

var OSX_CHROME = 'google chrome';

function openBrowser(url) {

  var browser = process.env.BROWSER;

  if (browser === 'none') {
    return false;
  }


  const shouldTryOpenChromeWithAppleScript = process.platform === 'darwin' &&
    (typeof browser !== 'string' || browser === OSX_CHROME);

  if (shouldTryOpenChromeWithAppleScript) {
    try {

      execSync('ps cax | grep "Google Chrome"');
      execSync('osascript openChrome.applescript ' + url, {
        cwd: __dirname,
        stdio: 'ignore',
      });
      return true;
    } catch (err) {
      // Ignore errors.
    }
  }

  
  if (process.platform === 'darwin' && browser === 'open') {
    browser = undefined;
  }

  try {
    var options = { app: browser };
    opn(url, options).catch(() => {}); 
    return true;
  } catch (err) {
    return false;
  }
}

module.exports = openBrowser;
